package com.livelearn.ignorance.activity;

import android.os.Bundle;
import android.support.v4.app.Fragment;
import android.support.v4.app.FragmentManager;
import android.support.v4.app.FragmentPagerAdapter;
import android.support.v4.view.ViewPager;

import com.livelearn.ignorance.R;
import com.livelearn.ignorance.config.Constant;
import com.livelearn.ignorance.fragment.PlaceholderFragment;
import com.livelearn.ignorance.utils.IntentUtils;
import com.livelearn.ignorance.utils.SharedPreferencesUtils;
import com.livelearn.ignorance.widget.viewpager.jellyviewpager.JellyViewPager;

import butterknife.BindView;
import butterknife.ButterKnife;

public class GuideActivity extends BaseActivity {

    public int[] images = {R.mipmap.guide_1, R.mipmap.guide_2, R.mipmap.guide_3, R.mipmap.guide_4};

    @BindView(R.id.container)
    JellyViewPager mViewPager;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_guide);
        ButterKnife.bind(this);

        setSwipeBackEnable(false);

        SectionsPagerAdapter mSectionsPagerAdapter = new SectionsPagerAdapter(getSupportFragmentManager());
        mViewPager.setAdapter(mSectionsPagerAdapter);
        mViewPager.addOnPageChangeListener(new ViewPager.OnPageChangeListener() {
            boolean once = true;

            @Override
            public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {
                if (once && position == mViewPager.getAdapter().getCount() - 1 && positionOffsetPixels > mViewPager.getHeight() / 3) {
                    IntentUtils.startActivity(GuideActivity.this, LoginActivity.class);
                    SharedPreferencesUtils.put(Constant.USER_INFO,Constant.GUIDE_STATE,true);
                    finish();
                    once = false;
                }
            }

            @Override
            public void onPageSelected(int position) {

            }

            @Override
            public void onPageScrollStateChanged(int state) {

            }
        });
    }

    public class SectionsPagerAdapter extends FragmentPagerAdapter {

        public SectionsPagerAdapter(FragmentManager fm) {
            super(fm);
        }

        @Override
        public Fragment getItem(int position) {
            PlaceholderFragment fragment = new PlaceholderFragment();
            Bundle args = new Bundle();
            args.putInt(Constant.ARG_SECTION_NUMBER, images[position]);
            fragment.setArguments(args);
            return fragment;
        }

        @Override
        public int getCount() {
            return images.length;
        }
    }
}
